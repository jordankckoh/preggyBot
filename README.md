# Telegram User Profile & Assistant Bot

A Telegram bot that collects user profile information, provides personalized tips, and answers user questions using AI.

## Features

- Conversational interface (`/start`) to collect user profile data (age, ethnicity, gender, stage, country, experience).
- Keyboard options for certain profile questions (gender, stage, experience).
- Persistent storage of user profiles in JSON format (`user_profiles.json`).
- View existing profile data (`/profile` command).
- Ask questions to an AI assistant aware of your profile (`/ask` command).
- Scheduled daily personalized tips relevant to the user's profile.
- Gender-specific profile setup (males automatically skip pregnancy stage questions).

## Setup

1. Clone this repository.
2. Create a virtual environment (recommended):
   ```bash
   python -m venv venv
   source venv/bin/activate  # On Linux/macOS
   # venv\Scripts\activate    # On Windows
   ```
3. Install required packages:
   ```bash
   pip install -r requirements.txt
   ```
4. Create a `.env` file in the project root and add the following variables:
   ```dotenv
   TELEGRAM_BOT_TOKEN=your_telegram_bot_token
   OPEN_AI_API_KEY=your_openai_api_key
   # OPEN_AI_MODEL=gpt-4o-mini # Optional: Specify a different OpenAI model if needed
   ```
   *(Note: `TELEGRAM_CHAT_ID` is no longer directly used by `main.py` for sending messages, as daily tips go to all registered users.)*

## Running the Bot

Ensure your virtual environment is activated, then start the bot:

```bash
python main.py
```

The bot will run continuously, polling for updates and executing scheduled jobs until stopped (e.g., with Ctrl+C).

## Bot Commands

- `/start` - Begin or update the profile setup process.
- `/profile` - View your current saved profile.
- `/ask` - Ask a question to the AI assistant.
- `/help` - Show available commands.
- `/cancel` - Cancel the current profile setup or question-asking process.

## Daily Tips & AI Responses

- **Daily Tips:** The bot is configured to automatically send a personalized tip to every registered user daily (default time is 09:00 UTC, adjustable in `main.py`). Tips are generated by `prompt.get_tips()` using OpenAI, considering the user's profile data.
- **AI Responses:** The `/ask` command allows users to ask questions. The bot uses `prompt.ask_question()` and OpenAI to generate a response, taking into account the user's profile for more relevant answers.

## Data Storage

User profiles are stored in `user_profiles.json` in the following format:

```json
{
  "123456789": {
    "age": "30",
    "ethnicity": "Asian",
    "gender": "Female",
    "stage": "2nd Trimester",
    "country": "Singapore",
    "experience": "First-time parent",
    "last_updated": "2023-08-01T12:34:56.789"
  }
  // ... other users
}
```

Where the key is the user's Telegram ID.

## Utility Scripts

- `view_profiles.py` - Run this script to see all saved user profiles in the console:
  ```bash
  python view_profiles.py
  ```

## Project Structure

- `main.py` - Main bot implementation: handles commands, conversations, scheduling, and lifecycle.
- `prompt.py` - Handles interactions with the OpenAI API for generating tips (`get_tips`) and answering questions (`ask_question`).
- `user_data.py` - Module for loading and saving user profile data to `user_profiles.json`.
- `view_profiles.py` - Utility script to view all saved profiles.
- `user_profiles.json` - Data storage file (created automatically).
- `.env` - Stores secret keys and configuration.
- `requirements.txt` - Lists Python package dependencies.
- `README.md` - This file.

## Development Notes

- The bot uses the `python-telegram-bot` library (v20+).
- Profile setup and question asking use `ConversationHandler` to manage multi-step interactions.
- Daily tips are scheduled using the built-in `JobQueue`.

## Adding New Features

1. To add new profile questions:
   - Add a new state constant in `main.py`.
   - Create a handler function for the new state (similar to `age`, `ethnicity`, etc.).
   - Update the `states` dictionary within the `profile_conv_handler` definition in `setup_application`.
   - Update `user_data.py` if necessary and the profile display strings.
2. To modify AI prompts (tips or Q&A):
   - Adjust the system messages or user prompt construction within the `get_tips()` and `ask_question()` functions in `prompt.py`.

## Project Structure

- `main.py` - Main bot implementation for collecting profile data
- `user_data.py` - Module for managing user profile data
- `prompt.py` - Script to generate and send personalized messages
- `view_profiles.py` - Utility to view all saved profiles
- `user_profiles.json` - Data storage file (created when first profile is saved)

## Adding New Features

1. To add new profile questions:
   - Add a new state constant in main.py
   - Create a handler function for the new state
   - Update the ConversationHandler with the new state and handler
   - Update any relevant keyboard options or response formatting

2. To modify automated messages:
   - Update the `generate_message()` function in prompt.py
   - Adjust the prompt templates as needed

3. To schedule regular messages:
   - Use cron jobs or a task scheduler to run prompt.py periodically

## Development

The bot uses the `python-telegram-bot` library and follows a conversation flow using `ConversationHandler`. Each step in the conversation collects different information from the user.

### Project Structure

- `test.py` - Main bot implementation
- `user_data.py` - Module for managing user profile data
- `view_profiles.py` - Utility to view all saved profiles
- `user_profiles.json` - Data storage file (created when first profile is saved)

## Adding New Features

To add new questions or data points:
1. Add a new state constant
2. Create a handler function for the new state
3. Update the ConversationHandler with the new state and handler
4. Update any relevant keyboard options or response formatting
5. Update the user_data.py module if needed for new data types

To send personalized messages to all users in your TELEGRAM_CHAT_ID list: 
